# 🏥 Agency OS - Autonomous Software Engineering Platform

**Version 0.9.5** - Documentation Optimization & Token Efficiency Release

Elite autonomous software engineering system with **proven self-healing capabilities**, **100% constitutional compliance**, and **93% token-optimized documentation**. Built with [Agency Swarm](https://agency-swarm.ai/welcome/overview) framework with tier-based navigation for autonomous agents.

## 🚀 Quick Start

**New to Agency?** Start here:
1. **Installation**: See `docs/getting-started/README.md`
2. **Architecture**: See `docs/architecture/overview.md`
3. **For Agents**: Use `/primecc` command + `.claude/quick-ref/city-map.md`

### 🔄 Professional Development Workflow
- **GitWorkflowTool**: Complete branch → commit → push → PR automation
- **Green Main Enforcement**: Automated test validation before any merge
- **Atomic Commits**: Constitutional compliance with clear, conventional commit messages
- **Pull Request Automation**: GitHub CLI integration for seamless PR creation

## 🎯 Mission-Critical Features

### Autonomous Development Protocol
- **Constitutional Governance**: Unbreakable quality standards with 100% test compliance
- **Self-Healing Architecture**: Autonomous detection, analysis, and resolution of issues
- **Pristine Development**: Spec-driven, test-first methodology with complete verification
- **Intelligent Orchestration**: 10 specialized agents working in perfect coordination

### Production Metrics
- **1,568 tests** passing with 100% success rate
- **Zero Dict[Any] violations** - complete type safety
- **Zero test failures** under constitutional enforcement
- **2-minute** comprehensive test execution

## 🚀 Autonomous Healing - The Key Differentiator

**The Agency can detect, analyze, fix, test, and commit software changes without human intervention.**

### Real Autonomous Healing
- **🔍 Error Detection**: Automatic recognition of NoneType errors from logs and runtime failures
- **🧠 LLM-Powered Analysis**: GPT-5 generates intelligent fixes with context awareness
- **🛠️ Automatic Application**: Patches applied autonomously with safety verification
- **✅ Test Verification**: Complete test suite validation before any changes are committed
- **📝 Version Control**: Automatic commits with full audit trails

### See It In Action
```bash
# Quick demo of autonomous healing
./agency demo

# Run full autonomous healing demonstration
python demo_autonomous_healing.py
```

## 🧠 Trinity Protocol - Production Ready

Multi-agent coordination system for autonomous development with **59% code reduction** and production-ready architecture.

### 🎯 Quick Start
```python
from trinity_protocol.core import ExecutorAgent, ArchitectAgent, WitnessAgent
from shared.message_bus import MessageBus

# Initialize Trinity agents
bus = MessageBus(":memory:")
witness = WitnessAgent(bus)        # Pattern detection
architect = ArchitectAgent(bus)    # Strategic planning
executor = ExecutorAgent(bus)      # Execution coordination

# Run autonomous cycle
await witness.detect_patterns()
await architect.create_plan()
await executor.execute_project()
```

### 📊 Trinity Metrics
- **8,063 lines** (down from 19,734 - 59% reduction)
- **100% test coverage** for production core
- **6 reusable components** in `shared/` (cost tracking, message bus, HITL protocol)
- **Clear structure**: `core/` (production) + `experimental/` + `demos/`

### 🔗 Resources
- **Documentation**: `trinity_protocol/README.md` - Complete usage guide
- **Demos**: `trinity_protocol/demos/` - Working examples (complete, HITL, preferences)
- **Architecture**: `TRINITY_CLEAN_BREAK_SUMMARY.md` - Reorganization details
- **ADR**: `docs/adr/ADR-020-trinity-protocol-production-ization.md` - Production readiness

## 🏛️ Constitutional Governance

The Agency operates under strict constitutional principles that ensure quality and reliability:

### The Five Articles
1. **Complete Context**: No action without full understanding
2. **100% Verification**: All tests must pass - no exceptions
3. **Automated Enforcement**: Quality standards technically enforced
4. **Continuous Learning**: Automatic improvement through experience
5. **Spec-Driven Development**: All features require formal specifications

## 🎯 Key Features

### Core Capabilities
- **🤖 Autonomous Healing**: Self-fixing software that learns and improves
- **📐 Multi-Agent Architecture**: 10 specialized agents working in coordination
- **🧠 Learning & Memory**: Cross-session learning with VectorStore integration
- **🛡️ Constitutional Compliance**: Unbreakable quality standards
- **🔒 Type Safety**: Zero Dict[Any] violations, JSONValue throughout
- **🔧 LLM-First Design**: Leverages GPT-5 intelligence instead of complex Python systems
- **🔬 DSPy Integration**: Advanced chain-of-thought reasoning with rationale fields

### Developer Experience
- **⚡ Quick Setup**: One-command environment setup
- **🧪 Comprehensive Testing**: 1,568+ tests maintaining 100% success rate
- **🔒 Type Safety**: Complete elimination of Dict[Any] for better IDE support
- **📊 Real-Time Monitoring**: Live system health and performance metrics
- **🔄 Hot Reload**: Instant feedback during development
- **📚 Rich Documentation**: Complete API docs and usage examples

## 🏗️ Simplified Architecture

### 10 Core Agents + DSPy Enhanced Agents
**Traditional Agency Swarm Agents:**
- **ChiefArchitectAgent**: Strategic oversight and self-directed task creation
- **AgencyCodeAgent**: Primary development agent with comprehensive toolset
- **PlannerAgent**: Strategic planning using spec-kit methodology
- **AuditorAgent**: Quality analysis using NECESSARY pattern
- **TestGeneratorAgent**: NECESSARY-compliant test generation
- **LearningAgent**: Pattern analysis and institutional memory
- **MergerAgent**: Integration and pull request management
- **QualityEnforcerAgent**: Constitutional compliance and autonomous healing
- **ToolsmithAgent**: Tool development and enhancement
- **WorkCompletionSummaryAgent**: Intelligent task summaries

**DSPy-Enhanced Agents (Experimental):**
- **DSPy PlannerAgent**: Advanced planning with chain-of-thought reasoning
- **DSPy CodeAgent**: Code generation with explicit rationale tracking
- **DSPy AuditorAgent**: Quality analysis with structured reasoning chains
- **DSPy LearningAgent**: Pattern recognition with semantic understanding
- **DSPy ToolsmithAgent**: Tool creation with design rationale

### Communication Flows
Clean, focused communication patterns between agents:
```
ChiefArchitect → Strategic oversight of all agents
QualityEnforcer ↔ TestGenerator ↔ Coder → Quality improvement pipeline
Planner ↔ Coder → Development workflow
Auditor → Quality assessment and violation detection
```

## 🚀 Quick Start for Autonomous Operations

### Prerequisites
- Python 3.12 or 3.13
- Git
- OpenAI API key or compatible LLM provider

### One-Command Setup
```bash
# Clone and initialize
git clone <repository-url>
cd Agency

# Automatic environment setup
./agency setup

# Verify constitutional compliance
python run_tests.py --run-all  # Must show 100% pass rate
```

### Environment Configuration
```bash
# .env file - Required for autonomous operations
OPENAI_API_KEY=your_api_key_here
AGENCY_MODEL=gpt-5                  # Primary model
USE_ENHANCED_MEMORY=true           # VectorStore integration
FORCE_RUN_ALL_TESTS=1              # Enable comprehensive testing
```

## 🏛️ Constitutional Framework

### The Five Articles (Mandatory Compliance)
1. **Article I - Complete Context**: No action without full understanding
2. **Article II - 100% Verification**: All tests must pass - no exceptions
3. **Article III - Automated Enforcement**: Quality standards technically enforced
4. **Article IV - Continuous Learning**: Automatic improvement through experience
5. **Article V - Spec-Driven Development**: All features require formal specifications

### Compliance Status: ✅ FULLY VERIFIED
- 1,568 tests passing (100% success rate)
- Zero Dict[Any] violations (complete type safety)
- Zero failures tolerated
- Automated enforcement active

## 🤖 Agent Architecture

### Core Agents & Responsibilities
```
ChiefArchitect ─────┬─→ Strategic Oversight
                    ├─→ ADR Creation
                    └─→ Self-Directed Tasks

Planner ────────────┬─→ Spec-Kit Methodology
                    ├─→ Task Decomposition
                    └─→ Strategic Planning

AgencyCodeAgent ────┬─→ Primary Development
                    ├─→ Tool Execution
                    └─→ Code Generation

QualityEnforcer ────┬─→ Constitutional Compliance
                    ├─→ Autonomous Healing
                    └─→ Test Verification

Auditor ────────────┬─→ NECESSARY Pattern
                    ├─→ Quality Analysis
                    └─→ Violation Detection
```

## 🧪 Testing Infrastructure

### Comprehensive Test Suite
```bash
# Run ALL 1,568 tests (production validation)
python run_tests.py --run-all

# Category-specific testing
python run_tests.py                    # Unit tests only
python run_tests.py --integration-only # Integration tests
python run_tests.py --benchmark        # Performance tests

# Must achieve 100% pass rate for constitutional compliance
```

### Test Categories & Coverage
- **Unit Tests**: Core functionality validation
- **Integration Tests**: Agent communication verification
- **E2E Tests**: Complete workflow validation
- **API Tests**: External service integration (with timeouts)
- **Benchmark Tests**: Performance validation
- **DSPy Agent Tests**: Chain-of-thought reasoning validation

### Quality Metrics
- **1,568 tests** with 100% success rate
- **Zero Dict[Any] violations** - complete type safety
- **Complete test coverage** for all autonomous healing features
- **Constitutional compliance** across all components
- **NECESSARY pattern adherence** for test quality
- **DSPy agent tests** with comprehensive validation

## 🏥 Autonomous Healing System

### Self-Healing Workflow
```
Error Detection → LLM Analysis → Fix Generation → Test Validation → Auto-Commit
       ↓                                                ↓
    Telemetry                                   Rollback on Failure
```

### Safety Mechanisms
- **Pre-commit Validation**: All changes tested before commit
- **Automatic Rollback**: Failed fixes immediately reverted
- **Audit Trail**: Complete history in `logs/autonomous_healing/`
- **Constitutional Guard**: No violations permitted

### NoneType Error Auto-Fix
The flagship autonomous healing capability:

1. **Detection**: Scans logs and runtime errors for NoneType patterns
2. **Analysis**: Uses LLM intelligence to understand context and generate fixes
3. **Application**: Applies fixes with automatic rollback on test failure
4. **Verification**: Runs complete test suite to ensure no regressions
5. **Commitment**: Commits successful fixes with detailed audit trails

### Healing Workflow
```bash
Error Detected → LLM Analysis → Fix Generated → Tests Pass → Auto-Commit
     ↓                                              ↓
Logged & Monitored                         Rollback on Failure
```

## 📊 Development Workflow

### Prime Commands (Mandatory Session Start)
```bash
# REQUIRED: Initialize session with prime command
/prime plan_and_execute     # Full development cycle
/prime audit_and_refactor   # Code quality improvement
/prime healing_mode         # Autonomous healing activation
/prime create_tool          # Tool development
```

### Development Protocol
1. **PRD Creation**: `/create_prd` - Formal requirements
2. **Task Generation**: `/generate_tasks` - Hierarchical breakdown
3. **Iterative Execution**: `/process_tasks` - Step-by-step implementation
4. **Verification**: Automatic test execution and validation

## 🔧 Advanced Configuration

### Model Policy
```python
# shared/model_policy.py controls agent models
PLANNER_MODEL=gpt-5          # Strategic planning
CODER_MODEL=gpt-5            # Development
AUDITOR_MODEL=gpt-5          # Quality analysis
QUALITY_ENFORCER_MODEL=gpt-5 # Constitutional compliance
```

### Memory & Learning
- **VectorStore Integration**: Semantic pattern matching
- **Cross-Session Learning**: Persistent knowledge base with Firestore
- **Pattern Recognition**: Automatic strategy identification
- **Institutional Memory**: Collective agent intelligence
- **Production Persistence**: Firestore backend for cross-session memory (see [Firestore Setup](docs/FIRESTORE_SETUP.md))

## 📈 Performance Metrics

### System Benchmarks
- **Test Execution**: 185 seconds for complete validation
- **Parallel Processing**: 10 workers for test execution
- **Memory Efficiency**: Optimized context management
- **API Timeouts**: 30-second limits on external calls

### Quality Metrics
- **Type Safety**: 100% mypy compliance
- **Test Coverage**: 1,562 tests across all modules
- **Constitutional Compliance**: Zero violations permitted
- **Healing Success Rate**: >95% autonomous resolution

## 🛠️ CLI Reference

### Essential Commands
```bash
# System validation
python run_tests.py --run-all         # Full test suite (required)
python agency.py                      # Main orchestration

# Demos and validation
python demo_unified.py                # Core demonstration
python demo_autonomous_healing.py     # Healing capabilities

# Quality checks
python scripts/constitutional_check.py # Compliance verification
```

### Advanced Usage
```bash
# Manual agency execution
sudo python agency.py

# Specific test categories
python run_tests.py --run-integration

# Autonomous healing demo
python demo_autonomous_healing.py
```

## 📈 Performance & Scaling

### Optimization Features
- **LLM-First Architecture**: Delegates complex analysis to GPT-5
- **Focused Tool Set**: Simplified from 36 to 10 essential tools
- **Efficient Communication**: Streamlined agent interactions
- **Background Processing**: Non-blocking operations for long-running tasks

### Scalability
- **Multi-Agent Coordination**: Parallel processing capabilities
- **Memory Optimization**: Efficient context management
- **Resource Monitoring**: Automatic performance tracking
- **Load Balancing**: Smart agent utilization

## 🔮 Advanced Features

### DSPy Integration (New!)
- **Chain-of-Thought Reasoning**: Explicit reasoning chains with rationale fields
- **A/B Testing Framework**: Compare traditional vs DSPy agents performance
- **Structured Signatures**: Type-safe input/output contracts for all operations
- **Optimized Prompting**: DSPy's automatic prompt optimization capabilities
- **Metrics-Driven**: Comprehensive code quality and performance metrics

### Learning & Memory
- **VectorStore Integration**: Semantic search for pattern matching
- **Cross-Session Learning**: Knowledge persists between runs
- **Pattern Recognition**: Automatic identification of successful strategies
- **Institutional Memory**: Collective agent intelligence

### Constitutional Enforcement
- **Real-Time Monitoring**: Continuous compliance checking
- **Automatic Violation Prevention**: Blocks non-compliant operations
- **Emergency Response**: Crisis management and system protection
- **Audit Trail**: Complete history of all enforcement actions

## 🤝 Contributing

### Development Workflow
1. Fork the repository
2. Create a feature branch
3. Implement changes with tests
4. Ensure 100% test pass rate
5. Submit pull request

### Code Quality Standards
- **Constitutional Compliance**: All 5 articles must be followed
- **Test Coverage**: 100% test success rate required
- **LLM-First**: Prefer LLM delegation over complex Python systems
- **Documentation**: Comprehensive docs for all features

## 📊 Monitoring & Observability

### Logging
- **Autonomous Healing**: `logs/autonomous_healing/`
- **Session Transcripts**: `logs/sessions/`
- **Agent Communications**: `logs/telemetry/`

### Health Monitoring
```bash
# Check system health
python -c "from core import get_core; print(get_core().get_health_status())"

# Run constitutional compliance check
python scripts/constitutional_check.py
```

## 📚 Documentation

### Core Documentation
- **[CLAUDE.md](CLAUDE.md)**: Master constitution and command reference
- **[AGENTS.md](AGENTS.md)**: Complete agent architecture
- **[CONSTITUTIONAL_COMPLIANCE_REPORT.md](CONSTITUTIONAL_COMPLIANCE_REPORT.md)**: Verification status
- **[TEST_FIXES_SUMMARY.md](TEST_FIXES_SUMMARY.md)**: Testing infrastructure details
- **[RECOVERY_SUMMARY.md](RECOVERY_SUMMARY.md)**: Recovery from over-engineering case study
- **[docs/FIRESTORE_SETUP.md](docs/FIRESTORE_SETUP.md)**: Production memory persistence guide

### Specifications & Plans
- **specs/**: Formal feature specifications (spec-kit methodology)
- **plans/**: Technical implementation plans
- **.claude/**: Agent configurations and commands

## 🚨 Critical Requirements

### For Autonomous Development
1. **Session Initialization**: Always start with `/prime` command
2. **Test Compliance**: 100% pass rate required (no exceptions)
3. **Constitutional Adherence**: All five articles must be followed
4. **Spec-Driven**: Complex features require formal specifications

### Quality Gates
- ✅ All tests must pass before any commit
- ✅ Type safety must be maintained
- ✅ Constitutional compliance is mandatory
- ✅ Learning patterns must be captured

## 📌 Release 0.9.5 - DSPy Integration & Chain-of-Thought

### What's New in 0.9.5
- **🔬 DSPy Framework Integration**: Advanced chain-of-thought reasoning capabilities
- **🎯 Rationale Fields**: Explicit reasoning tracking for all agent decisions
- **📊 A/B Testing Framework**: Compare traditional vs DSPy agent performance
- **🧪 1,562 Tests**: Comprehensive test suite with 100% pass rate
- **🚀 5 DSPy Agents**: Enhanced versions of core agents with structured reasoning

### Previous Release (0.9.4)
- **🏛️ 100% Constitutional Compliance**: All articles verified
- **✅ Complete Test Infrastructure**: All tests executable with `--run-all`
- **⚡ Production Ready**: Full validation in under 3 minutes
- **🔧 100% Type Safety**: Complete mypy compliance achieved

### Infrastructure Improvements
- Enhanced `run_tests.py` with true `--run-all` capability
- Removed artificial test skips for comprehensive validation
- Fixed all LearningLoop import issues
- Added pytest-timeout for API test management
- Environment variable overrides for forced test execution

## 🏆 Operational Status

The Agency has achieved **complete operational autonomy** with:

- ✅ **100% Constitutional Compliance** verified
- ✅ **Zero Test Failures** achieved
- ✅ **Self-Healing Capabilities** operational
- ✅ **Production-Ready** validation complete
- ✅ **Autonomous Development** fully enabled
- ✅ **DSPy Integration** for advanced reasoning

### Verification Command
```bash
# Confirm operational status (must show 1,562 passed, 0 failed)
python run_tests.py --run-all
```

## 🎉 Operational Autonomy Achieved

The Agency demonstrates that autonomous software maintenance is operational today. Experience a system that maintains and improves itself while adhering to the highest quality standards through constitutional governance, continuous learning, and now enhanced with DSPy's advanced reasoning capabilities.

**Welcome to the age of truly intelligent, autonomous software engineering.**

---

*Constitutionally compliant, autonomously maintained, perpetually improving.*

*Version 0.9.5 - Verified 2025-09-30*